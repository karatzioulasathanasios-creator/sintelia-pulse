export default {
  async fetch(req) {
    const url = new URL(req.url);
    const symbol = url.searchParams.get("symbol") || "BTC-EUR";

    const r = await fetch(
      "https://api.exchange.coinbase.com/products/" + symbol + "/ticker",
      {
        headers: {
          "User-Agent": "SINTELIA",
          "Accept": "application/json"
        }
      }
    );

    if(!r.ok){
      return new Response(JSON.stringify({error:"bad symbol"}),{status:500});
    }

    const j = await r.json();

    return new Response(
      JSON.stringify({
        price: Number(j.price),
        time: j.time
      }),
      {
        headers:{
          "Content-Type":"application/json",
          "Access-Control-Allow-Origin":"*"
        }
      }
    );
  }
};
